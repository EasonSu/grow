name: GitHub Actions - Document Hooks
description: Generate documentation of WordPress hooks.
inputs:
  source-directories:
    description: Comma-separated list of directories to search for hooks
    required: true
    default: 'src/'

  main-branch:
    description: The main branch of the repository
    default: main

  debug-output:
    description: Add debugging output
    required: false
    default: 'no'

outputs:
  hook-docs:
    description: The documentation generated by the script
    value: ${{ steps.run-documentation-generator.outputs.hook-docs }}

  debugging-output:
    description: Extra debugging output from some commands
    value: ${{ steps.debugging-output.debugging-output }}

runs:
  using: "composite"
  steps:
    - name: Run composer install for the action repo
      id: composer-install
      shell: bash
      run: |
        composer install -no --no-dev --ignore-platform-reqs -d "$GITHUB_ACTION_PATH"
        if [ $? -ne 0 ]; then
          exit $?
        fi
    - name: Run documentation generator
      id: run-documentation-generator
      if: ${{ success() }}
      shell: bash
      run: |
        cd $GITHUB_ACTION_PATH
        echo "hook-docs<<EOF" >> "$GITHUB_OUTPUT"
        php bin/github-actions-hook-documentor.php >> "$GITHUB_OUTPUT"
        echo "EOF" >> "$GITHUB_OUTPUT"
        cd -
        if [ $? -ne 0 ]; then
          exit $?
        fi
      env:
        SOURCE_DIRECTORIES: ${{ inputs.source-directories }}
        SHA: ${{ github.sha }}
        MAIN_BRANCH: ${{ inputs.main-branch }}
        BASE_URL: ${{ github.server_url }}/${{ github.repository }}
        WORKSPACE: ${{ github.workspace }}

    - name: Debugging output
      id: debugging-output
      shell: bash
      run: |
        echo "$(pwd && ls -la && env)"
      if: ${{ failure() }} || 'yes' == inputs.debug-output
