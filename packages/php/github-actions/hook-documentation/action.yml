name: GitHub Actions - Document Hooks
description: Generate documentation of WordPress hooks.
inputs:
  source-directories:
    description: Comma-separated list of directories to search for hooks
    required: true
    default: 'src/'

  main-branch:
    description: The main branch of the repository
    default: main

  debug-output:
    description: Add debugging output
    required: false
    default: 'no'

outputs:
  hook-docs:
    description: The documentation generated by the script
    value: ${{ steps.run-documentation-generator.outputs.hook-docs }}

  debugging-output:
    description: Extra debugging output from some commands
    value: ${{ steps.debugging-output.debugging-output }}

runs:
  using: "composite"
  steps:
    - name: Checkout the repository
      uses: actions/checkout@v3

    - name: Run documentation generator
      id: run-documentation-generator
      shell: bash
      run: |
        SOURCE_DIRECTORIES=${{ inputs.source-directories }} \
        MAIN_BRANCH=${{ inputs.main-branch }} \
        php bin/github-actions-hook-documentor.php >> $GITHUB_OUTPUT
        if [ $? -ne 0 ]; then
          exit 1
        fi

    - name: Debugging output
      id: debugging-output
      shell: bash
      run: |
        echo "debugging-output=$(pwd && ls -la && env)" >> $GITHUB_OUTPUT
      if: ${{ failure() }} || 'yes' == inputs.debug-output
